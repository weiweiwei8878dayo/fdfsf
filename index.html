<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»£è¡Œé€²æ—ç¢ºèªãƒ»ç®¡ç†ãƒ‘ãƒãƒ«</title>
    <style>
        body { background: #0f172a; color: #eee; font-family: sans-serif; padding: 20px; }
        .container { max-width: 900px; margin: auto; }
        .card { background: #1e293b; padding: 25px; border-radius: 12px; border: 1px solid #334155; margin-bottom: 20px; }
        h1 { border-left: 5px solid #3b82f6; padding-left: 15px; font-size: 1.5rem; }
        
        /* é€²æ—ç¢ºèªç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .checker-box { text-align: center; }
        input { background: #0f172a; border: 1px solid #334155; color: #fff; padding: 12px; border-radius: 6px; width: 80%; max-width: 300px; margin-bottom: 15px; outline: none; }
        button { background: #3b82f6; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        button:hover { background: #2563eb; }
        
        #result-display { margin-top: 25px; display: none; border-top: 1px solid #334155; padding-top: 20px; }
        .status-badge { display: inline-block; padding: 5px 15px; border-radius: 20px; font-weight: bold; font-size: 0.9em; background: #334155; }
        .active { background: #22c55e; color: white; }

        /* ç®¡ç†è€…ãƒ†ãƒ¼ãƒ–ãƒ«ã‚¹ã‚¿ã‚¤ãƒ« */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 12px; border-bottom: 1px solid #334155; text-align: left; }
        th { color: #94a3b8; font-size: 0.9em; }
        .status-yes { color: #22c55e; font-weight: bold; }
        .loading { text-align: center; color: #64748b; }
    </style>
</head>
<body>
    <div class="container">
        <div id="user-view">
            <h1>ğŸ” ä»£è¡Œé€²æ—ã‚’ç¢ºèªã™ã‚‹</h1>
            <div class="card checker-box">
                <p style="color: #94a3b8;">ä¾é ¼æ™‚ã«ä½¿ç”¨ã—ãŸã€ŒDiscord IDã€ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>
                <input type="text" id="targetId" placeholder="ä¾‹: 1262777743368781834">
                <br>
                <button onclick="checkStatus()">é€²æ—ã‚’æ¤œç´¢</button>

                <div id="result-display">
                    <p>ç¾åœ¨ã®çŠ¶æ…‹: <span id="statusText" class="status-badge active">èª­ã¿è¾¼ã¿ä¸­...</span></p>
                    <p>ä¾é ¼å†…å®¹: <strong id="itemText">---</strong></p>
                    <p style="font-size: 0.8em; color: #64748b;">æœ€çµ‚æ›´æ–°: <span id="timeText">---</span></p>
                </div>
            </div>
        </div>

        <div id="admin-view" style="display: none;">
            <h1>ğŸˆ ç®¡ç†è€…ç”¨ï¼šä¾é ¼ãƒªã‚¹ãƒˆ</h1>
            <div class="card">
                <table id="list-table">
                    <thead>
                        <tr>
                            <th>æ—¥ä»˜</th>
                            <th>ãƒ¦ãƒ¼ã‚¶ãƒ¼</th>
                            <th>é‡‘é¡</th>
                            <th>BANä¿è¨¼</th>
                        </tr>
                    </thead>
                    <tbody id="list-body"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const params = new URLSearchParams(window.location.search);
        const isAdmin = params.get('id') === 'yudai2011';

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆ‡ã‚Šæ›¿ãˆ
        if (isAdmin) {
            document.getElementById('user-view').style.display = 'none';
            document.getElementById('admin-view').style.display = 'block';
            loadAdminList();
        }

        // --- æ¶ˆè²»è€…ç”¨ï¼šé€²æ—æ¤œç´¢æ©Ÿèƒ½ ---
        async function checkStatus() {
            const userId = document.getElementById('targetId').value.trim();
            if(!userId) return alert("IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");

            try {
                // å‰å›ã® save-id.js ã§ä¿å­˜ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                const res = await fetch(`/.netlify/functions/save-id?id=${userId}`);
                if (!res.ok) throw new Error();
                
                const data = await res.json();
                document.getElementById('result-display').style.display = 'block';
                document.getElementById('statusText').innerText = data.status || "æ”¯æ‰•ã„ç¢ºèªå¾…ã¡";
                document.getElementById('itemText').innerText = data.item || "ä»£è¡Œãƒ¡ãƒ‹ãƒ¥ãƒ¼";
                document.getElementById('timeText').innerText = data.lastUpdate ? new Date(data.lastUpdate).toLocaleString() : "---";
            } catch (e) {
                alert("è©²å½“ã™ã‚‹ä¾é ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚");
            }
        }

        // --- ç®¡ç†è€…ç”¨ï¼šãƒªã‚¹ãƒˆèª­ã¿è¾¼ã¿ ---
        async function loadAdminList() {
            try {
                const res = await fetch(`/.netlify/functions/get-ids?pw=yudai2011`);
                const data = await res.json();
                const body = document.getElementById('list-body');
                body.innerHTML = '';
                
                data.reverse().forEach(item => {
                    body.innerHTML += `<tr>
                        <td>${new Date(item.date).toLocaleDateString()}</td>
                        <td>${item.userName}</td>
                        <td>${item.amount}å††</td>
                        <td class="${item.banOption === 'yes' ? 'status-yes' : ''}">
                            ${item.banOption === 'yes' ? 'ğŸ›¡ï¸ ã‚ã‚Š' : 'ãªã—'}
                        </td>
                    </tr>`;
                });
            } catch (e) {
                document.getElementById('list-body').innerHTML = '<tr><td colspan="4">é€šä¿¡ã‚¨ãƒ©ãƒ¼</td></tr>';
            }
        }
    </script>
</body>
</html>

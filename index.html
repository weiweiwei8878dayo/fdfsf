<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»£è¡Œã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª</title>
    <style>
        body { font-family: sans-serif; background: #f4f4f9; color: #333; padding: 20px; text-align: center; }
        
        /* --- å…±é€šã‚¹ã‚¿ã‚¤ãƒ« --- */
        h1 { color: #444; margin-bottom: 20px; }
        .hidden { display: none; } /* è¡¨ç¤ºåˆ‡æ›¿ç”¨ */

        /* --- ãŠå®¢æ§˜ç”¨æ¤œç´¢ç”»é¢ --- */
        #user-view {
            background: white; padding: 40px; border-radius: 10px; 
            max-width: 600px; margin: 50px auto; box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        input[type="text"] { 
            padding: 15px; width: 60%; border: 1px solid #ddd; border-radius: 5px; font-size: 16px; 
        }
        button.search-btn { 
            padding: 15px 25px; background: #28a745; color: white; border: none; 
            border-radius: 5px; font-size: 16px; cursor: pointer; margin-left: 10px;
        }
        
        /* çµæœã‚«ãƒ¼ãƒ‰ */
        .result-card { 
            background: #f9f9f9; padding: 20px; border-radius: 8px; 
            border-left: 5px solid #28a745; margin-top: 20px; text-align: left;
        }
        .label { font-weight: bold; color: #555; }
        .value { font-size: 1.1em; font-weight: bold; margin-left: 10px; }

        /* --- ç®¡ç†è€…ç”¨ç”»é¢ --- */
        #admin-view { max-width: 1200px; margin: 0 auto; }
        table { width: 100%; border-collapse: collapse; background: #fff; margin-top: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        th, td { padding: 12px; border-bottom: 1px solid #ddd; text-align: left; }
        th { background: #007bff; color: white; }
        tr:hover { background: #f1f1f1; }

        /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸ */
        .badge-wait { color: #d9534f; font-weight: bold; }
        .badge-work { color: #f0ad4e; font-weight: bold; }
        .badge-done { color: #5cb85c; font-weight: bold; }
    </style>
</head>
<body>

    <!-- â–¼ ãŠå®¢æ§˜ç”¨ç”»é¢ï¼ˆé€šå¸¸ã‚¢ã‚¯ã‚»ã‚¹ã§è¡¨ç¤ºï¼‰ â–¼ -->
    <div id="user-view" class="hidden">
        <h1>ğŸ“¦ ã”ä¾é ¼çŠ¶æ³ã®ç¢ºèª</h1>
        <p>Discordã®ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
        <div>
            <input type="text" id="searchId" placeholder="ä¾‹: 123456789012345678">
            <button class="search-btn" onclick="searchUser()">æ¤œç´¢</button>
        </div>

        <!-- æ¤œç´¢çµæœã‚¨ãƒªã‚¢ -->
        <div id="search-result" class="hidden">
            <div class="result-card">
                <p><span class="label">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:</span><span id="u-status" class="value">-</span></p>
                <p><span class="label">æ›´æ–°æ—¥æ™‚:</span><span id="u-date" class="value">-</span></p>
                <p><span class="label">æ³¨æ–‡å†…å®¹:</span><span id="u-item" class="value">-</span></p>
                <p><span class="label">é‡‘é¡:</span><span id="u-amount" class="value">-</span></p>
                <p><span class="label">BANä¿è¨¼:</span><span id="u-ban" class="value">-</span></p>
            </div>
        </div>
        <p id="not-found" class="hidden" style="color:red; margin-top:20px;">âš ï¸ è©²å½“ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</p>
    </div>

    <!-- â–¼ ç®¡ç†è€…ç”¨ç”»é¢ï¼ˆ?pw=xxx ã®æ™‚ã ã‘è¡¨ç¤ºï¼‰ â–¼ -->
    <div id="admin-view" class="hidden">
        <h1>ğŸ”§ ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
        <p style="text-align:right;">è‡ªå‹•æ›´æ–°ä¸­...</p>
        <table>
            <thead>
                <tr>
                    <th>æ—¥æ™‚</th>
                    <th>ãƒ¦ãƒ¼ã‚¶ãƒ¼å</th>
                    <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                    <th>å†…å®¹</th>
                    <th>é‡‘é¡</th>
                    <th>BANä¿è¨¼</th>
                    <th>ID</th>
                </tr>
            </thead>
            <tbody id="admin-tbody"></tbody>
        </table>
    </div>

    <script>
        // ğŸ”‘ ã“ã“ã§URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®š
        const SECRET_PASS = "yudai2011"; 

        let allData = [];

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ãƒ¢ãƒ¼ãƒ‰åˆ¤å®š
        window.onload = async () => {
            const params = new URLSearchParams(window.location.search);
            const pw = params.get('pw');
            const idParam = params.get('id'); // ä¸€èˆ¬ç”¨URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

            // ãƒ‡ãƒ¼ã‚¿ã®å–å¾—
            try {
                const res = await fetch('db.json?' + new Date().getTime());
                if(res.ok) allData = await res.json();
            } catch(e) { console.error("Data error"); }

            // åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯
            if (pw === SECRET_PASS) {
                // ç®¡ç†è€…ãƒ¢ãƒ¼ãƒ‰
                showAdminMode();
            } else {
                // ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¢ãƒ¼ãƒ‰
                document.getElementById('user-view').style.display = 'block';
                // ?id=... ãŒã‚ã‚Œã°è‡ªå‹•æ¤œç´¢
                if(idParam) {
                    document.getElementById('searchId').value = idParam;
                    searchUser();
                }
            }
        };

        // --- ç®¡ç†è€…ãƒ¢ãƒ¼ãƒ‰ã®å‡¦ç† ---
        function showAdminMode() {
            document.getElementById('admin-view').style.display = 'block';
            renderAdminTable();
            // 30ç§’ã”ã¨ã«æ›´æ–°
            setInterval(async () => {
                const res = await fetch('db.json?' + new Date().getTime());
                if(res.ok) {
                    allData = await res.json();
                    renderAdminTable();
                }
            }, 30000);
        }

        function renderAdminTable() {
            const tbody = document.getElementById('admin-tbody');
            tbody.innerHTML = "";
            // æ—¥ä»˜é †
            allData.sort((a, b) => new Date(b.lastUpdate) - new Date(a.lastUpdate));

            allData.forEach(d => {
                let stClass = "";
                if(d.status.includes("å¾…ã¡")) stClass = "badge-wait";
                else if(d.status.includes("ä½œæ¥­")) stClass = "badge-work";
                else if(d.status.includes("å®Œäº†")) stClass = "badge-done";

                const row = `<tr>
                    <td>${new Date(d.lastUpdate).toLocaleString('ja-JP')}</td>
                    <td>${d.userName}</td>
                    <td class="${stClass}">${d.status}</td>
                    <td>${d.item || "-"}</td>
                    <td>${d.amount ? d.amount + "å††" : "-"}</td>
                    <td>${d.banOption === "yes" ? "ã‚ã‚Š" : "ãªã—"}</td>
                    <td style="font-size:11px; color:#888;">${d.userId}</td>
                </tr>`;
                tbody.innerHTML += row;
            });
        }

        // --- ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã®å‡¦ç† ---
        function searchUser() {
            const input = document.getElementById('searchId').value.trim();
            const resultBox = document.getElementById('search-result');
            const notFound = document.getElementById('not-found');

            const target = allData.find(d => d.userId === input);

            if (target) {
                notFound.style.display = 'none';
                resultBox.style.display = 'block';

                // DOMæ›´æ–°
                const stElem = document.getElementById('u-status');
                stElem.innerText = target.status;
                stElem.className = "value";
                if(target.status.includes("å¾…ã¡")) stElem.classList.add("badge-wait");
                else if(target.status.includes("ä½œæ¥­")) stElem.classList.add("badge-work");
                else if(target.status.includes("å®Œäº†")) stElem.classList.add("badge-done");

                document.getElementById('u-date').innerText = new Date(target.lastUpdate).toLocaleString('ja-JP');
                document.getElementById('u-item').innerText = target.item || "-";
                document.getElementById('u-amount').innerText = target.amount ? target.amount + "å††" : "-";
                document.getElementById('u-ban').innerText = target.banOption === "yes" ? "ã‚ã‚Š" : "ãªã—";
            } else {
                resultBox.style.display = 'none';
                notFound.style.display = 'block';
            }
        }
    </script>
</body>
</html>

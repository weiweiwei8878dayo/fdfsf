<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”’ å³é‡ç®¡ç†ãƒ‘ãƒãƒ« | gxxf</title>
    <style>
        body { background: #0f172a; color: white; font-family: 'Helvetica Neue', Arial, sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .login-box { background: #1e293b; padding: 40px; border-radius: 16px; border: 1px solid #334155; text-align: center; box-shadow: 0 20px 50px rgba(0,0,0,0.5); width: 350px; }
        .admin-content { display: none; width: 95%; max-width: 1200px; height: 90vh; overflow-y: auto; align-self: flex-start; margin-top: 40px; }
        h1, h2 { color: #f8fafc; margin-bottom: 20px; }
        input[type="password"], input[type="text"] { background: #334155; border: 1px solid #475569; color: white; padding: 12px; border-radius: 8px; width: 100%; box-sizing: border-box; font-size: 1rem; margin-bottom: 15px; }
        button { background: #3b82f6; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; font-size: 1rem; transition: background 0.3s; }
        button:hover { background: #2563eb; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; background: #1e293b; border-radius: 12px; overflow: hidden; }
        th, td { border-bottom: 1px solid #334155; padding: 15px; text-align: left; }
        th { background: #334155; color: #94a3b8; font-size: 0.9rem; text-transform: uppercase; }
        .ban-badge { background: #ef4444; color: white; padding: 4px 8px; border-radius: 6px; font-weight: bold; font-size: 0.8rem; border: 1px solid #ff0000; box-shadow: 0 0 10px rgba(239, 68, 68, 0.3); }
        code { background: #000; padding: 4px 8px; border-radius: 6px; color: #10b981; font-family: monospace; font-size: 0.9rem; }
        .status-on { color: #22c55e; font-weight: bold; }
        #error-msg { color: #f87171; font-size: 0.9rem; margin-top: 10px; display: none; }
    </style>
</head>
<body>

    <div id="login-gate" class="login-box">
        <div style="font-size: 3rem; margin-bottom: 10px;">ğŸ›¡ï¸</div>
        <h2>ç®¡ç†è€…èªè¨¼</h2>
        <p style="color: #94a3b8; font-size: 0.9rem; margin-bottom: 25px;">ã‚¢ã‚¯ã‚»ã‚¹ã«ã¯å°‚ç”¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒå¿…è¦ã§ã™</p>
        <input type="password" id="pw-input" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›..." onkeypress="if(event.key==='Enter') attemptLogin()">
        <button onclick="attemptLogin()">ãƒ­ã‚°ã‚¤ãƒ³</button>
        <p id="error-msg">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“</p>
    </div>

    <div id="main-content" class="admin-content">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h1>ğŸ“‹ é¡§å®¢ãƒ»ã«ã‚ƒã‚“ã“IDãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹</h1>
            <div class="status-on">â— ã‚·ã‚¹ãƒ†ãƒ ç¨¼åƒä¸­</div>
        </div>
        
        <div style="margin: 20px 0;">
            <input type="text" id="search" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼åã€IDã€ã¾ãŸã¯å†…å®¹ã§æ¤œç´¢..." onkeyup="filterTable()">
        </div>

        <table id="data-table">
            <thead>
                <tr>
                    <th>æ—¥ä»˜</th>
                    <th>ãƒ¦ãƒ¼ã‚¶ãƒ¼å</th>
                    <th>Discord ID</th>
                    <th>é‡‘é¡</th>
                    <th>BANä¿è¨¼çŠ¶æ…‹</th>
                    <th>è©³ç´°å†…å®¹</th>
                </tr>
            </thead>
            <tbody id="table-body">
                </tbody>
        </table>
    </div>

    <script>
        // ãƒ­ã‚°ã‚¤ãƒ³è©¦è¡Œ
        async function attemptLogin() {
            const pw = document.getElementById('pw-input').value;
            const error = document.getElementById('error-msg');
            
            // Functionã«ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’æŠ•ã’ã¦ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
            try {
                const res = await fetch(`/.netlify/functions/get-ids?pw=${pw}`);
                
                if (res.status === 200) {
                    const data = await res.json();
                    document.getElementById('login-gate').style.display = 'none';
                    document.getElementById('main-content').style.display = 'block';
                    document.body.style.alignItems = 'flex-start'; // ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆèª¿æ•´
                    renderTable(data);
                } else {
                    error.style.display = 'block';
                    document.getElementById('pw-input').value = '';
                }
            } catch (e) {
                alert("é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚");
            }
        }

        // ãƒ†ãƒ¼ãƒ–ãƒ«æç”»
        function renderTable(data) {
            const tbody = document.getElementById('table-body');
            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;">ä¾é ¼ãƒ‡ãƒ¼ã‚¿ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“</td></tr>';
                return;
            }
            
            tbody.innerHTML = data.reverse().map(item => `
                <tr>
                    <td>${new Date(item.date).toLocaleDateString()}</td>
                    <td><b>${item.userName}</b></td>
                    <td><code>${item.userId}</code></td>
                    <td>Â¥${Number(item.amount).toLocaleString()}</td>
                    <td>
                        ${item.banOption === 'yes' 
                            ? '<span class="ban-badge">ğŸ›¡ï¸ è¦äºˆå‚™å¢</span>' 
                            : '<span style="color:#64748b">ãªã—</span>'}
                    </td>
                    <td style="font-size: 0.85rem; color: #cbd5e1;">${item.items || 'ä»£è¡Œå‡¦ç†æ¸ˆã¿'}</td>
                </tr>
            `).join('');
        }

        // æ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿
        function filterTable() {
            const val = document.getElementById('search').value.toLowerCase();
            const rows = document.querySelectorAll('#table-body tr');
            rows.forEach(row => {
                row.style.display = row.innerText.toLowerCase().includes(val) ? '' : 'none';
            });
        }
    </script>
</body>
</html>

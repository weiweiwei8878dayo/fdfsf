<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»£è¡Œã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª</title>
    <style>
        body { font-family: sans-serif; background: #f4f4f9; color: #333; padding: 20px; text-align: center; }
        h1 { color: #444; margin-bottom: 20px; }
        .hidden { display: none; }

        /* ãŠå®¢æ§˜ç”¨ç”»é¢ */
        #user-view {
            background: white; padding: 40px; border-radius: 10px; 
            max-width: 600px; margin: 50px auto; box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        input[type="text"] { padding: 15px; width: 60%; border: 1px solid #ddd; border-radius: 5px; font-size: 16px; }
        button.search-btn { padding: 15px 25px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; margin-left: 10px; }
        
        /* çµæœã‚«ãƒ¼ãƒ‰ */
        .result-card { background: #f9f9f9; padding: 20px; border-radius: 8px; border-left: 5px solid #28a745; margin-top: 20px; text-align: left; }
        .label { font-weight: bold; color: #555; }
        .value { font-size: 1.1em; font-weight: bold; margin-left: 10px; }
        
        /* ç”»åƒãƒªãƒ³ã‚¯ãƒœã‚¿ãƒ³ */
        .ss-link {
            display: inline-block; margin-top: 5px; padding: 5px 10px; 
            background: #007bff; color: white; text-decoration: none; border-radius: 4px; font-size: 0.9em;
        }
        .ss-link:hover { background: #0056b3; }

        /* ç®¡ç†è€…ç”»é¢ */
        #admin-view { max-width: 1200px; margin: 0 auto; }
        table { width: 100%; border-collapse: collapse; background: #fff; margin-top: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        th, td { padding: 12px; border-bottom: 1px solid #ddd; text-align: left; }
        th { background: #007bff; color: white; }
        .badge-wait { color: #d9534f; font-weight: bold; }
        .badge-work { color: #f0ad4e; font-weight: bold; }
        .badge-done { color: #5cb85c; font-weight: bold; }
    </style>
</head>
<body>

    <!-- ãŠå®¢æ§˜ç”¨ç”»é¢ -->
    <div id="user-view" class="hidden">
        <h1>ğŸ“¦ ã”ä¾é ¼çŠ¶æ³ã®ç¢ºèª</h1>
        <p>Discordã®ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
        <div>
            <input type="text" id="searchId" placeholder="ä¾‹: 123456789012345678">
            <button class="search-btn" onclick="searchUser()">æ¤œç´¢</button>
        </div>

        <div id="search-result" class="hidden">
            <div class="result-card">
                <p><span class="label">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:</span><span id="u-status" class="value">-</span></p>
                <p><span class="label">æ›´æ–°æ—¥æ™‚:</span><span id="u-date" class="value">-</span></p>
                <p><span class="label">æ³¨æ–‡å†…å®¹:</span><span id="u-item" class="value">-</span></p>
                <p><span class="label">é‡‘é¡:</span><span id="u-amount" class="value">-</span></p>
                <p><span class="label">BANä¿è¨¼:</span><span id="u-ban" class="value">-</span></p>
                <!-- è¨¼æ‹ ç”»åƒã‚¨ãƒªã‚¢ -->
                <p id="u-ss-area" class="hidden"><span class="label">å®Œäº†è¨¼æ‹ :</span> <a id="u-ss-link" class="ss-link" href="#" target="_blank">ğŸ“· ç”»åƒã‚’ç¢ºèªã™ã‚‹</a></p>
            </div>
        </div>
        <p id="not-found" class="hidden" style="color:red; margin-top:20px;">âš ï¸ è©²å½“ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</p>
    </div>

    <!-- ç®¡ç†è€…ç”¨ç”»é¢ -->
    <div id="admin-view" class="hidden">
        <h1>ğŸ”§ ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
        <p style="text-align:right;">è‡ªå‹•æ›´æ–°ä¸­...</p>
        <table>
            <thead>
                <tr>
                    <th>æ—¥æ™‚</th>
                    <th>ãƒ¦ãƒ¼ã‚¶ãƒ¼å</th>
                    <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                    <th>å†…å®¹</th>
                    <th>é‡‘é¡</th>
                    <th>è¨¼æ‹ </th>
                    <th>ID</th>
                </tr>
            </thead>
            <tbody id="admin-tbody"></tbody>
        </table>
    </div>

    <script>
        const SECRET_PASS = "yudai2011"; // ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
        let allData = [];

        window.onload = async () => {
            const params = new URLSearchParams(window.location.search);
            const pw = params.get('pw');
            const idParam = params.get('id');

            try {
                const res = await fetch('db.json?' + new Date().getTime());
                if(res.ok) allData = await res.json();
            } catch(e) { console.error("Data error"); }

            if (pw === SECRET_PASS) {
                showAdminMode();
            } else {
                document.getElementById('user-view').style.display = 'block';
                if(idParam) {
                    document.getElementById('searchId').value = idParam;
                    searchUser();
                }
            }
        };

        function showAdminMode() {
            document.getElementById('admin-view').style.display = 'block';
            renderAdminTable();
            setInterval(async () => {
                const res = await fetch('db.json?' + new Date().getTime());
                if(res.ok) { allData = await res.json(); renderAdminTable(); }
            }, 30000);
        }

        function renderAdminTable() {
            const tbody = document.getElementById('admin-tbody');
            tbody.innerHTML = "";
            allData.sort((a, b) => new Date(b.lastUpdate) - new Date(a.lastUpdate));

            allData.forEach(d => {
                let stClass = "";
                if(d.status.includes("å¾…ã¡")) stClass = "badge-wait";
                else if(d.status.includes("ä½œæ¥­")) stClass = "badge-work";
                else if(d.status.includes("å®Œäº†")) stClass = "badge-done";

                // è¨¼æ‹ ãƒªãƒ³ã‚¯ã®æœ‰ç„¡
                const ssHtml = (d.ssUrl && d.ssUrl.startsWith("http")) 
                    ? `<a href="${d.ssUrl}" target="_blank" class="ss-link">ç”»åƒ</a>` 
                    : "-";

                const row = `<tr>
                    <td>${new Date(d.lastUpdate).toLocaleString('ja-JP')}</td>
                    <td>${d.userName}</td>
                    <td class="${stClass}">${d.status}</td>
                    <td>${d.item || "-"}</td>
                    <td>${d.amount ? d.amount + "å††" : "-"}</td>
                    <td>${ssHtml}</td>
                    <td style="font-size:11px; color:#888;">${d.userId}</td>
                </tr>`;
                tbody.innerHTML += row;
            });
        }

        function searchUser() {
            const input = document.getElementById('searchId').value.trim();
            const resultBox = document.getElementById('search-result');
            const notFound = document.getElementById('not-found');
            const ssArea = document.getElementById('u-ss-area');
            const ssLink = document.getElementById('u-ss-link');

            const target = allData.find(d => d.userId === input);

            if (target) {
                notFound.style.display = 'none';
                resultBox.style.display = 'block';

                const stElem = document.getElementById('u-status');
                stElem.innerText = target.status;
                stElem.className = "value";
                if(target.status.includes("å¾…ã¡")) stElem.classList.add("badge-wait");
                else if(target.status.includes("ä½œæ¥­")) stElem.classList.add("badge-work");
                else if(target.status.includes("å®Œäº†")) stElem.classList.add("badge-done");

                document.getElementById('u-date').innerText = new Date(target.lastUpdate).toLocaleString('ja-JP');
                document.getElementById('u-item').innerText = target.item || "-";
                document.getElementById('u-amount').innerText = target.amount ? target.amount + "å††" : "-";
                document.getElementById('u-ban').innerText = target.banOption === "yes" ? "ã‚ã‚Š" : "ãªã—";

                // è¨¼æ‹ ç”»åƒã®è¡¨ç¤ºåˆ¶å¾¡
                if (target.ssUrl && target.ssUrl.startsWith("http")) {
                    ssArea.style.display = "block";
                    ssLink.href = target.ssUrl;
                } else {
                    ssArea.style.display = "none";
                }
            } else {
                resultBox.style.display = 'none';
                notFound.style.display = 'block';
            }
        }
    </script>
</body>
</html>

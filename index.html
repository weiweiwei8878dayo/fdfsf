<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»£è¡Œä¾é ¼ç®¡ç†ãƒ‘ãƒãƒ«</title>
    <style>
        body { font-family: sans-serif; background: #f4f4f9; color: #333; padding: 20px; }
        h1 { text-align: center; color: #444; }
        .container { max-width: 1200px; margin: 0 auto; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; background: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; font-size: 14px; }
        th { background: #007bff; color: #fff; white-space: nowrap; }
        tr:hover { background: #f1f1f1; }
        
        /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®è‰²åˆ†ã‘ */
        .status-wait { color: #d9534f; font-weight: bold; } /* æ”¯æ‰•ã„å¾…ã¡ - èµ¤ */
        .status-work { color: #f0ad4e; font-weight: bold; } /* ä½œæ¥­ä¸­ - ã‚ªãƒ¬ãƒ³ã‚¸ */
        .status-done { color: #5cb85c; font-weight: bold; } /* å®Œäº† - ç·‘ */

        .ban-yes { background-color: #dff0d8; color: #3c763d; padding: 2px 5px; border-radius: 3px; font-size: 12px; }
        .ban-no { background-color: #f2dede; color: #a94442; padding: 2px 5px; border-radius: 3px; font-size: 12px; }
    </style>
</head>
<body>
    <h1>ğŸ“‹ ä»£è¡Œä¾é ¼ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ çŠ¶æ³</h1>
    <div class="container">
        <table id="orderTable">
            <thead>
                <tr>
                    <th>æ›´æ–°æ—¥æ™‚</th>
                    <th>ãƒ¦ãƒ¼ã‚¶ãƒ¼å</th>
                    <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                    <th>æ³¨æ–‡å†…å®¹</th>
                    <th>é‡‘é¡</th>
                    <th>BANä¿è¨¼</th>
                    <th>ID</th>
                </tr>
            </thead>
            <tbody>
                <!-- ãƒ‡ãƒ¼ã‚¿ãŒã“ã“ã«èª­ã¿è¾¼ã¾ã‚Œã¾ã™ -->
            </tbody>
        </table>
    </div>

    <script>
        async function loadData() {
            try {
                // ã‚­ãƒ£ãƒƒã‚·ãƒ¥å›é¿ã®ãŸã‚ã«ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ä»˜ä¸
                const res = await fetch('db.json?' + new Date().getTime());
                const data = await res.json();
                
                // æ—¥ä»˜ãŒæ–°ã—ã„é †ã«ã‚½ãƒ¼ãƒˆ
                data.sort((a, b) => new Date(b.lastUpdate) - new Date(a.lastUpdate));

                const tbody = document.querySelector("#orderTable tbody");
                tbody.innerHTML = "";

                data.forEach(entry => {
                    const row = document.createElement("tr");

                    // æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
                    const date = new Date(entry.lastUpdate).toLocaleString('ja-JP');

                    // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã«å¿œã˜ãŸã‚¯ãƒ©ã‚¹é©ç”¨
                    let statusClass = "";
                    if (entry.status.includes("å¾…ã¡")) statusClass = "status-wait";
                    else if (entry.status.includes("ä½œæ¥­")) statusClass = "status-work";
                    else if (entry.status.includes("å®Œäº†")) statusClass = "status-done";

                    // BANä¿è¨¼ã®è¡¨ç¤º
                    const banBadge = entry.banOption === "yes" 
                        ? '<span class="ban-yes">ã‚ã‚Š</span>' 
                        : '<span class="ban-no">ãªã—</span>';

                    row.innerHTML = `
                        <td>${date}</td>
                        <td>${entry.userName}</td>
                        <td class="${statusClass}">${entry.status}</td>
                        <td>${entry.item || "-"}</td>
                        <td>${entry.amount ? entry.amount + "å††" : "-"}</td>
                        <td>${entry.banOption !== "-" ? banBadge : "-"}</td>
                        <td style="font-size:10px; color:#888;">${entry.userId}</td>
                    `;
                    tbody.appendChild(row);
                });
            } catch (err) {
                console.error("ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:", err);
            }
        }
        // åˆå›èª­ã¿è¾¼ã¿ã¨è‡ªå‹•æ›´æ–°
        loadData();
        setInterval(loadData, 30000); // 30ç§’ã”ã¨ã«æ›´æ–°
    </script>
</body>
</html>
